# [Vanilla] From file common\scripted_effects\00_prison_effects.txt
# A lite version of imprison_character_effect without opinion penalties or other consequences (as they were captured in war, not at your command)
# [PoW]
# scope:PoW_army needed
prisoner_of_war_capture_effect = {
	if = {
		limit = { debug_only = yes }
		debug_log = "dbg_log prisoner_of_war_capture_effect"
		debug_log_scopes = no
		$TARGET$ = { debug_log_scopes = no }
		$IMPRISONER$ = { debug_log_scopes = no }
		scope:barony ?= { debug_log_scopes = no }
	}
	$TARGET$ = { save_temporary_scope_as = new_target }
	$IMPRISONER$ = { save_temporary_scope_as = imprisoner }
	if = {
		limit = { NOT = { exists = scope:barony }}
		$TARGET$.location.barony = { save_scope_as = barony }
	}
	scope:barony = {
		if = {
			limit = { NOT = { exists = scope:army }}
			if = {
				limit = { exists = scope:raider }
				root = { save_scope_as = army }
			}
			else = {
				scope:barony.title_province = {
					ordered_army_in_location = {
						limit = {
							army_owner = scope:imprisoner
							exists = army_commander
						}
						save_scope_as = army
					}
				}
				
			}
		}
		scope:army ?= {
			debug_log_scopes = no
			if = {
				limit = { exists = army_commander }
				army_commander ?= {
					scope:imprisoner = {
						imprison = {
							target = scope:new_target
							type = prisoner_of_war
						}
					}
					scope:new_target = { set_location = scope:barony.title_province }
					debug_log_scopes = no
					if = {
						limit = { NOT = { exists = var:commander_story }}
						create_story = PoW_commander_story
					}
					var:commander_story = {
						add_to_variable_list = {
							name = PoW
							target = scope:new_target
						}
					}
				}
			}
		}
	}
}
# [/PoW]
